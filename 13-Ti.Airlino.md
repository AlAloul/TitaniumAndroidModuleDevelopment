#Ti.Airlino

This tutorial shows, how you can implement  a REST interface in titanium and later how you can user a ready to use library (class) of Android to bild i.e. a Bonjour browser.

First we build a native module (without Titanium stuff). Therefore we can use this package later in noTitanium projects.

##AirlinoAdapter.java

Airlino is a hardware device for receiving streamed audio data and for playing audio URLs. Maybe some users has more then one of this black boxes and therefore we need instances. The protocol is for all function http/POST/JSON. The pdf with detailled  protocol description you can find [here](https://github.com/AppWerft/Ti.Airlino/blob/master/SPEC_HBM10-v4.2.0.pdf).

There are a lot of http clients for android/java. In this solution we use  [ AsyncHttpClient](http://loopj.com/android-async-http/). From this website we download the newest jars and copy to lib folder:

<img src="http://i.imgur.com/KdVyecA.png" width=300 />

Now we open with right click the project folder, select *properties* and add this both jars into classpath.

The class contains three components: constructor, a collection of methods and the client with callback impementation.


###Variables
```java
private String ENDPOINT;
private Context ctx;
private onResultHandler resultHandler;
private	HashMap<String, String> map =new HashMap<String, String>();
```

###Constructor
```java
public AirlinoAdapter(Context ctx, String endpoint) {
		this.ctx = ctx;
		this.ENDPOINT = endpoint;
	}
```
We have only 2 instance variables: the context and the endpoint of request. 

###Methods
We have a lot of methods. As example the playRadio-method:
```java
public void playRadio(String url, String name, onResultHandler resultHandler)
			throws UnsupportedEncodingException, JSONException {
	map.clear();
	map.put("url", url);
	map.put("action", "play");
	map.put("name", name);
	doRequest("radio.action", map, resultHandler);
}
```
In case of *playRadio* we have three parameters: the url and name of station and the "callback". In a HashMap (similar to javascript object) we collect some parameters to realise a clean call interface.

In the end we call a generic *doRequest* with action, collection of paramters in map and a reference to callback. 

###doRequest
```java
private void doRequest(String action, HashMap<String, String> map, onResultHandler resultHandler) throws JSONException, UnsupportedEncodingException {
	AsyncHttpClient client = new AsyncHttpClient();
	JSONObject jsonParams = new JSONObject();
	for (String key : map.keySet()) {
		jsonParams.put(key, map.get(key));
	}
	StringEntity entity = new StringEntity(jsonParams.toString());
	client.post(ctx, ENDPOINT, entity, "application/json",
			new AirlinoResponseHandler());

}
```

