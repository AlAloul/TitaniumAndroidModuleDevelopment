#Ti.AppLifecycle


##foreGround/backGround
An android app is a container of activities and other components. These activities are the visible screens, with other words the UI for the user. They lifes in lifecycles. 

![](https://developer.android.com/images/activity_lifecycle.png)

If we have a reference to an activity then we  all events are available, in Titanium too.

###Problem 
In some cases we need an info about state on app level. The only way is a dirty way to inspect which activity in foreground. If the activity is changed then we can fire an event.

###Idea
In module we start a cronjob. The cronjob looks in process table and detects if the toppest task is changed. The `cronJob.scheduleAtFixedRate` method is related to setInterval() of javascript. The code inside the brackets is related to to function in javascript. We start the code at `onAppCreate` method. And we don't forget to cancel the cronjob at `onAppDestroy` method.
```java
cronJob.scheduleAtFixedRate(new TimerTask() {
			@Override
			public void run() {
				boolean isInFront = false;
				TaskTestResult result = isInForeground();
				isInFront = result.getIsForground();
				if (isInFront != wasInForeGround
						|| lastPackageName != result.getPackageName()) {
					Log.d(LCAT,
							"new top package name: >>>>>>>>> "
									+ result.getPackageName());
					String key = (isInFront == true) ? "resumed" : "paused";
					if (FIRE_EVENT_ENABLED == true) {
						KrollDict dict = new KrollDict();
						dict.put("packageName", result.getPackageName());
						mApp.fireAppEvent(key, dict);
					}
					Log.d(LCAT, key);
					wasInForeGround = isInFront;
				}
			}
		}, 0, testInterval);
```


##Screen On/Off
